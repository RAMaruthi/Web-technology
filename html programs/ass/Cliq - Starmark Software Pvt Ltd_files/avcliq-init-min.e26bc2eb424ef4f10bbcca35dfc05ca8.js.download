var ZCJsAjax={};ZCJsAjax={CSRF_HEADER:"X-ZCSRF-TOKEN",NETWORK_PREFIX:"/network/",COMPANY_PREFIX:"/company/",AV_CUSTOM_DOMAIN_PREFIX:"/_avcliq",MODIFY_ZAAID_HEADER:"x-modify-zaaid",IS_INIT:!1,init:function(){var e=window.location.pathname;e.startsWith(this.NETWORK_PREFIX)?this.SCREEN_NAME=e.split("/")[2]:e.startsWith(this.COMPANY_PREFIX)&&(this.APPACCOUNT_ID=e.split("/")[2]),this.IS_INIT=!0},isIntranetRequest:function(){return void 0===this.SCREEN_NAME||null===this.SCREEN_NAME||""===this.SCREEN_NAME},getURLPrefix:function(){var e=$zcg._COMMON_DOMAIN_BASED_UI?$zcg._CLIQ_CONTEXT:"";return this.IS_INIT||this.init(),this.isIntranetRequest()?(this.APPACCOUNT_ID&&$zcg._IS_COMPANY_PREFIX_ENABLED&&(e=e+this.COMPANY_PREFIX+this.APPACCOUNT_ID),e):this.NETWORK_PREFIX+this.SCREEN_NAME},removePrefix:function(e){if(e.startsWith("/guest")&&(e=e.substr(e.indexOf("/v2"))),e.startsWith(this.NETWORK_PREFIX)){var t=e.split("/")[2],n=this.NETWORK_PREFIX+t;e=e.split(n)[1]}if(e.startsWith($zcg._CLIQ_CONTEXT)&&(e=e.split($zcg._CLIQ_CONTEXT)[1]),e.startsWith(this.COMPANY_PREFIX)){n=e.split("/").splice(0,3).join("/");e=e.split(n)[1]}return e.startsWith(this.AV_CUSTOM_DOMAIN_PREFIX)&&(e=e.split(this.AV_CUSTOM_DOMAIN_PREFIX)[1]),e},ajax:function(e){var t;if(t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.headers=e.headers||{},e.headers[$zcg.JSON_EXCEPTION_HEADER]="true",e.headers[this.CSRF_HEADER]=$zcg._CFPARAMNAME+"="+this.getCookie($zcg._CFCOOKIENAME),e.url=this.getURLPrefix()+e.url,void 0===e.type&&(e.type="GET"),"GET"===e.type?"object"==typeof e.data&&(e.data.nocache=(new Date).getTime(),e.url+=this.serialize(e.data)):"application/json"===e.contenttype&&(e.data=JSON.stringify(e.data),e.headers.ContentType="application/json"),t.open(e.type,e.url,!0),e.progress&&t.upload)try{t.upload.addEventListener("progress",(function(t){e.progress(t)}),!1),t.addEventListener("progress",(function(t){e.progress(t)}),!1)}catch(e){}if(void 0!==e.headers)for(var n in e.headers)t.setRequestHeader(n,e.headers[n]);return t.onreadystatechange=function(){if(4==t.readyState){e.url=ZCJsAjax.removePrefix(e.url),ZCJsAjax.handleAppaccountPrefix(t);var n=t.responseText;try{if("object"!=typeof n&&(n=JSON.parse(n)),n&&"ip_restricted"==n.code)return void(window.location.href=$zcg._SERVERURL+"/iprestricted.do");if(Array.isArray(n)){if(0===n.length)return;n=n[0]}}catch(e){}if(e.url.startsWith("/v2/")){var a=n;" undefined"===t.status||200!=t.status&&202!=t.status&&204!=t.status&&304!=t.status?"function"==typeof e.error&&e.error(a):e.success(a)}else if(void 0!==n.status){var i=n.status;if("OK"===i||"SUCCESS"===i){var s={};-1===e.url.indexOf("/v2/")?(s.data=n.data,s.meta=n.meta):s=n,e.success(s)}else if("FAILED"===i){var r=n.data;r.desc=n.desc,e.error(r)}}else try{a=-1===e.url.indexOf("/v2/")?n.objString:n," undefined"===t.status||200!=t.status&&202!=t.status&&204!=t.status&&304!=t.status?(void 0===a&&n&&n.code&&e.url.indexOf("/v1/imports")>=0&&(a=n),e.error(a)):e.success(a)}catch(t){e.error(a)}}},t.send(e.data),t},serialize:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")},getCookie:function(e){var t=document.cookie.indexOf(e+"="),n=document.cookie.length,a=null;if(-1!==t){var i=e.length;beginIndex=t+i,-1!==(a=document.cookie.substr(beginIndex+1,n)).indexOf(";")&&(a=a.substring(0,a.indexOf(";")))}return a},formData:function(e,t,n,a){var i=new FormData;for(var s in e)i.append(s,e[s]);if(a&&i.append($zcg._CFPARAMNAME,this.getCookie($zcg._CFCOOKIENAME)),void 0!==n){s=0;for(var r=n.length;s<r;s++){var o=n[s];void 0!==o[1]?i.append(t,o[0],o[1]):i.append(t,o[0])}}return i},handleAppaccountPrefix:function(e){var t=e.getResponseHeader(ZCJsAjax.MODIFY_ZAAID_HEADER);if(void 0!==e&&null!=t){var n=window.location.pathname,a="";""!==t&&(a=ZCJsAjax.COMPANY_PREFIX+t),n=n.replace(/\/company\/[0-9]+/,a),this.APPACCOUNT_ID=t,window.location.pathname!==n&&window.history.pushState({},"",window.location.origin+n)}}};var AVCliqUtil={},AVCliqConstants={},AVCliqAPI={ResourceTimingAPI:void 0,BroadcastChannelAPI:void 0,CustomStorage:void 0};AVCliqConstants={moduleName:"avcalls",eType:{INTERNAL_API:"10",AJAX_API:"11",ON_LOAD_MSG:"100",BROADCAST_CHANNEL_MSG:"101"},localStorage_cleanup_timeout:6e4},window.onload=function(e){var t=window.location!=window.parent.location?document.referrer:document.location.href;t&&""!==t||(t=$zcg._AV_FRAME_ORIGIN),t&&(AVCliqUtil.setParentDomain(t),ZCJsAjax.init(),$zcg._IS_AVCLIQ_SYNC_WMS_MESSAGE_ACCROSS_TABS_ENABLED&&AVCliqAPI.BroadcastChannelAPI.initialize(),AVCliqUtil.postMessageToParent({module:AVCliqConstants.moduleName,eType:AVCliqConstants.eType.ON_LOAD_MSG}))},window.addEventListener("message",e=>{if(!AVCliqUtil.isValidDomain(e))throw new Error("Invalid cross domain access");var t=JSON.parse(e.data);if(t.module===AVCliqConstants.moduleName){var n=t.reqId,a=t.eType;if(a===AVCliqConstants.eType.INTERNAL_API){var i=AVCliqAPI[t.apiName][t.apiMethod](...t.apiParams);AVCliqUtil.postMessageToParent({eType:a,reqId:n,module:AVCliqConstants.moduleName,successResp:i||""})}else if(a===AVCliqConstants.eType.AJAX_API){AVCliqUtil.sendHttpReq(t.params,(function(e,t,i){var s,r;AVCliqUtil.postMessageToParent({eType:a,reqId:n,module:AVCliqConstants.moduleName,successResp:e,headers:(s=t.getAllResponseHeaders().trim().split(/[\r\n]+/),r={},s.forEach((function(e){var t=e.split(": "),n=t.shift(),a=t.join(": ");r[n]=a})),r),banner:i})}),(function(e,t,i){AVCliqUtil.postMessageToParent({eType:a,reqId:n,module:AVCliqConstants.moduleName,errorResp:e,banner:i})}))}}},!1),AVCliqUtil={_parentDomain:void 0,setParentDomain:function(e){this._parentDomain=e},getParentDomain:function(){return this._parentDomain},isValidDomain:function(e){var t=new URL(e.origin).host,n=window.location.host;return this.getBaseDomain(t)===this.getBaseDomain(n)},getBaseDomain:function(e){var t=e.split(".");return t.slice(t.length-2,t.length).join(".")},constructFormData:function(e,t){var n=[new File([e.fileData],e.fileName,{type:"text/plain"}),e.fileName];return ZCJsAjax.formData(e.formDataParams,e.fileParamName,[n],t)},sendHttpReq:function(e,t,n){if(void 0!==e.data&&(e.contenttype="application/json"),e.sendStringAsFile&&(e.data=this.constructFormData(e.fileHash,e.type),delete e.fileHash),e.avoidDuplicateRequest){var a=AVCliqAPI.CustomStorage.isEnabled?AVCliqAPI.CustomStorage:localStorage;if(null!==a.getItem(e.url))return;setTimeout((function(){a.removeItem(e.url)}),AVCliqConstants.localStorage_cleanup_timeout),a.setItem(e.url,!0),delete e.avoidDuplicateRequest}let i={};void 0!==e.status&&(i=e.status);var s=ZCJsAjax.ajax(Object.assign(e,{success:function(e){t(e,s,i)},error:function(e){n(e,s,i)}}))},postMessageToParent:function(e){window.parent.postMessage(JSON.stringify(e),this.getParentDomain())}},AVCliqAPI.ResourceTimingAPI=function(){var e={},t=function(){return"undefined"!=typeof performance};return{isSupported:t,startPerformanceRecording:function(n){t()&&("function"==typeof performance.clearResourceTimings&&0===Object.keys(e).length&&performance.clearResourceTimings(),e[n]={startTime:Date.now()})},stopRecordingAndGetReport:function(t){if(void 0!==e[t]){var n=e[t];return n.id=t,n.endTime=Date.now(),n.recordingDuration=n.endTime-n.startTime,delete e[t],function(e){var t,n=performance.getEntriesByType("resource");if(!(void 0===n||n.length<=0)){t="Calculating network resource load time for : "+JSON.stringify(e,null,4);for(var a=0;a<n.length;a++){var i={name:n[a].name,redirect_time:n[a].redirectEnd-n[a].redirectStart,dns_time:n[a].domainLookupEnd-n[a].domainLookupStart,tcp_handshake_time:n[a].connectEnd-n[a].connectStart,secure_conn_time:n[a].secureConnectionStart>0?n[a].connectEnd-n[a].secureConnectionStart:"0",response_time:n[a].responseEnd-n[a].responseStart,fetch_till_respend:n[a].fetchStart>0?n[a].responseEnd-n[a].fetchStart:"0",reqstart_till_respend:n[a].requestStart>0?n[a].responseEnd-n[a].requestStart:"0",start_till_respend:n[a].startTime>0?n[a].responseEnd-n[a].startTime:"0"};t+="\n["+a+"] --\x3e "+JSON.stringify(i,null,4)}return t}t="No performance records available for :"+JSON.stringify(e,null,4)}(n)}}}}(),AVCliqAPI.BroadcastChannelAPI=function(){let e=void 0,t=!1;const n={channel_name:"avcliq_broadcast_channel",msgBoradcast:"msgBroadcast",storageSync:"storageSync"};function a(n,a){if(!t)throw new Error("Broadcast channel is not initialized");e.postMessage(JSON.stringify({name:n,time:(new Date).getTime(),data:a}))}return{updateCustomStorage:function(e,t){a(n.storageSync,{action:"set",key:e,value:t})},deleteFromCustomStorage:function(e){a(n.storageSync,{action:"reset",key:e})},initialize:function(){t=!0,(e=new BroadcastChannel(n.channel_name)).onmessage=function(e){var t=JSON.parse(e.data);switch(t.name){case n.msgBoradcast:!function(e){AVCliqUtil.postMessageToParent({eType:AVCliqConstants.eType.BROADCAST_CHANNEL_MSG,module:AVCliqConstants.moduleName,message:e.data})}(t);break;case n.storageSync:!function(e){AVCliqAPI.CustomStorage.handleSync(e)}(t)}}},close:function(){e.close()},sendMessage:function(e){a(n.msgBoradcast,e)}}}(),AVCliqAPI.CustomStorage=function(){let e={};return{isEnabled:!1,getItem:function(t){return e[t]||null},setItem:function(t,n){e[t]=n,AVCliqAPI.BroadcastChannelAPI.updateCustomStorage(t,n)},removeItem:function(t){delete e[t],AVCliqAPI.BroadcastChannelAPI.deleteFromCustomStorage(t)},handleSync:function(t){"set"===t.data.action?e[t.data.key]=t.data.value:"reset"===t.data.action&&delete e[t.data.key]}}}();